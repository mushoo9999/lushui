<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="0">
    <link rel="stylesheet" href="css/swiper-3.4.2.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/iconfont.css">
    <link rel="stylesheet" href="css/my.css">
    <script src="js/jquery-1.10.1.min.js"></script>
    <script src="js/swiper-3.4.2.jquery.min.js"></script>
    <title>饼哥！~~</title>
</head>

<body>
    <div class="content">
        <div class="rongqi  ">
            <img src="img/ditu.gif" alt="" class="gif animated myfadeOut" />
            <div class="biaoji">
                <img src="img/map.png" alt="" class="map animated myfadeIn" />
                <!-- <img src="img/map.png" alt="" class="map" /> -->
                <span class="daba" style="top:94px;left:494px;"><i class="iconfont icon-map"></i>1号A副坝</span>
                <span class="daba" style="top:105px;left:460px;"><i class="iconfont icon-map"></i>1号B副坝</span>
                <span class="daba" style="top:261px;left:539px;"><i class="iconfont icon-map"></i>2号副坝</span>
                <span class="daba" style="top:373px;left:544px;"><i class="iconfont icon-map"></i>3号副坝</span>
                <span class="daba" style="top:400px;left:540px;"><i class="iconfont icon-map"></i>主坝</span>
                <span class="daba" style="top:460px;left:600px;"><i class="iconfont icon-map"></i>4号副坝</span>
                <span class="daba" style="top:470px;left:645px;"><i class="iconfont icon-map"></i>5号副坝</span>
                <span class="daba" style="top:500px;left:654px;"><i class="iconfont icon-map"></i>6号A副坝</span>
                <span class="daba" style="top:510px;left:683px;"><i class="iconfont icon-map"></i>6号B副坝</span>
                <span class="daba" style="top:576px;left:926px;"><i class="iconfont icon-map"></i>8号副坝</span>
                <span class="daba" style="top:665px;left:1166px;"><i class="iconfont icon-map"></i>9号副坝</span>
                <span class="daba" style="top:690px;left:1168px;"><i class="iconfont icon-map"></i>10号副坝</span>
                <span class="daba" style="top:704px;left:1192px;"><i class="iconfont icon-map"></i>11号副坝</span>
            </div>
        </div>
    </div>
    <i class="iconfont icon-pause toggle" style="display: none"></i>
    <div class="model flex">
        <i class="iconfont icon-close"></i>
        <div class="text animated flex"></div>
        <div class="swiper-container">
            <div class="swiper-wrapper">
            </div>
            <div class="swiper-button-prev swiper-button-white"></div>
            <div class="swiper-button-next swiper-button-white"></div>
        </div>
    </div>
</body>
<script type="text/javascript">
const data = { //数据
    "1号A副坝": {
        "content": "坝型为均质粘土坝，坝顶长141.9m，最大坝高12.2m，坝基特性：粉质粘土；右岸布置有北灌区渠首，设计引水能力40m3 /s，计划灌溉农田40万亩。",
        "img": ["img/1号A副坝1.jpg", "img/1号A副坝2.jpg", "img/1号A副坝3.jpg"]
    },
    "1号B副坝": {
        "content": "坝型为均质粘土坝，坝顶长112.3m，最大坝高11.3m，坝基特性：粘土夹碎石。一号B副坝是遭遇超标准洪水时备用的爆溃式非常溢洪道",
        "img": ["img/1号B副坝1.jpg", "img/1号B副坝2.jpg", "img/1号B副坝3.jpg"]
    },
    "2号副坝": {
        "content": "是由均质粘土坝改建而成的泄洪闸，全长102.2m，最大坝高16m，坝顶高程59m，坝基特性：石英砂岩和粉砂岩。设有三孔泄洪闸，采用低鼻坎挑流消能，当枢纽遭遇超标准洪水时启用",
        "img": ["img/2号副坝1.jpg", "img/2号副坝2.jpg", "img/2号副坝3.jpg"]
    },
    "3号副坝": {
        "content": "坝型为浆砌石坝，坝顶长80.0m，最大坝高5.9m，坝顶高程58.0m，防浪墙顶高程 59.0m。坝基特性：泥岩和砂质页岩。",
        "img": ["img/3号副坝1.jpg", "img/3号副坝2.jpg", "img/3号副坝3.jpg"]
    },
    "主坝": {
        "content": "坝型为混凝土重力坝，是我国第一次采用预制混凝土块安装筑坝技术的试验工程。坝顶长 234.3m ，最大坝高 49m，坝顶高程 58m，防浪墙顶高程 59.2m。由左右岸墩、溢流坝段、挡水坝段、厂房坝段等组成。",
        "img": ["img/主坝1.jpg", "img/主坝2.jpg", "img/主坝3.jpg"]
    },
    "4号副坝": {
        "content": "坝型为浆砌块石坝,最大坝高 6.5m，坝顶长82.0m，坝顶高程58.0m，防浪墙顶高程59.0m。坝基特性：泥岩和砂质页岩",
        "img": ["img/4号副坝1.jpg", "img/4号副坝2.jpg", "img/4号副坝3.jpg"]
    },
    "5号副坝": {
        "content": "坝型为浆砌块石坝,最大坝高 6.5m，坝顶长82.0m，坝顶高程58.0m，防浪墙顶高程59.0m。坝基特性：泥岩和砂质页岩。",
        "img": ["img/5号副坝1.jpg", "img/5号副坝2.jpg", "img/5号副坝3.jpg"]
    },
    "6号A副坝": {
        "content": "由六号A、六号B两座副坝组成。六号A副坝坝型：粘土窄心墙风化屑坝壳坝，坝顶长115.0m，大坝高25.9m，坝体内设有混凝土防渗墙。六号B副坝坝型：粘土斜心墙坝壳土石坝，坝顶长83.0m，最大坝高5.2m。坝基特性：砂质、泥质页岩。",
        "img": ["img/6号A副坝1.jpg", "img/6号A副坝2.jpg", "img/6号A副坝3.jpg"]
    },
    "6号B副坝": {
        "content": "由六号A、六号B两座副坝组成。六号A副坝坝型：粘土窄心墙风化屑坝壳坝，坝顶长115.0m，最大坝高25.9m，坝体内设有混凝土防渗墙。六号B副坝坝型：粘土斜心墙坝壳土石坝，坝顶长83.0m，最大坝高5.2m。坝基特性：砂质、泥质页岩。",
        "img": ["img/6号B副坝1.jpg", "img/6号B副坝2.jpg", "img/6号B副坝3.jpg"]
    },
    "8号副坝": {
        "content": "坝型为均质粘土坝，坝顶高程59.0m，坝顶长1543.0m，最大坝高25.6m，防浪墙顶高程60.2m，坝体内设有混凝土防渗墙。曾被誉为“亚洲第一粘土坝”。坝基特性：冲积层、洪积层。",
        "img": ["img/8号副坝1.jpg", "img/8号副坝2.jpg", "img/8号副坝3.jpg"]
    },
    "9号副坝": {
        "content": "坝型为均质粘土坝，坝顶高程58.0m，坝顶长81.0m，最大坝高6.7m。坝基特性：网纹状红色粘土。",
        "img": ["img/9号副坝1.jpg", "img/9号副坝2.jpg", "img/9号副坝3.jpg"]
    },
    "10号副坝": {
        "content": "坝型为粘土均质坝，坝顶高程58.0m，防浪墙顶高程59.0m，坝顶长度77.0m，最大坝高3m。坝基特性：砂质、泥质页。",
        "img": ["img/10号副坝1.jpg", "img/10号副坝2.jpg", "img/10号副坝3.jpg"]
    },
    "11号副坝": {
        "content": "坝型为粘土宽心墙风化屑坝壳坝，坝顶长78m，最大坝高13.2m，坝基特性：粉质粘土",
        "img": ["img/11号副坝1.jpg", "img/11号副坝2.jpg", "img/11号副坝3.jpg"]
    }
}
let time = 0,
    save = 0,
    stop,
    mySwiper = undefined;
const len = $(".biaoji span.daba").length;

function preLoadImg(url) {
    var img = new Image();
    img.src = url;
}
$(document).ready(function() {
    const w = $(".rongqi").width(),
        h = $(".rongqi").height();
    let s = 0;
    $(".daba").addClass("pointer_none");
    setTimeout(() => {
        $(".biaoji span.daba").each(function(i, n) {
            let t = $(n).position().top,
                l = $(n).position().left;
            $(n).css({
                "animation": "fadeInDownBig .5s ease-out " + s + "s forwards"
            });
            s = s + 0.2
        });
        setTimeout(() => {
            $(".daba").removeClass("pointer_none");
            go();
            start();
            $(".toggle").fadeIn()
        }, (s + 0.5) * 1000)
    }, 6000)
})

function start() { //启动循环
    $(".model .icon-close").hide();
    $(".swiper-button-white").hide();
    if (save != 0) {
        time = save;
        save = 0;
        go();
    }
    let xxx = setInterval(() => {
        go();
        if (time == len + 1) {
            //alert("搞完收工")
            time = 0
            clearInterval(xxx);
        }
    }, 2000 * 3 + 1000);
    stop = function() {
        clearInterval(xxx);
        $(".model .icon-close").show();
        $(".swiper-button-white").show();
        save = time
    }
}

function go() { //步进动画
    if (time == len) {
        time = 0
    }
    console.log(time)
    let dom = $(".biaoji");
    let w = $(".content").width(),
        h = $(".content").height();
    $(".model").removeClass("show");
    dom.css({
        "left": w / 2 - dom.find("span").eq(time).position().left + "px",
        "top": h / 2 - dom.find("span").eq(time).position().top + "px",
        "transform": "scale(1.3)"
    });
    dom.find("span").removeClass("active").eq(time).addClass("active");
    time++;

   
    model();
}

function model() { //弹窗
    document.querySelector(".icon-close").onclick = function() {
        $(this).parents(".model").removeClass("show");
        $(".biaoji").css({
            "left": "0",
            "top": "0",
            "transform": "scale(1)"
        })
    }
    setTimeout(() => {
        const m = $(".model");
        let index = Object.keys(data)[time - 1];
        if (mySwiper) mySwiper.destroy(true, true);
        m.find(".swiper-wrapper").html("");
        for (let i in data[index].img) {
            m.find(".swiper-wrapper").append('<div class="swiper-slide flex"><img src="' + data[index].img[i] + '" width="100%"></div>')
        }
        mySwiper = new Swiper('.swiper-container', {
            effect: 'coverflow',
            slidesPerView: data[index].img.length,
            centeredSlides: true,
            lazyLoading: true,
            lazyLoadingInPrevNext: true,
            width: 2400,
            height: 533.33,
            autoplay: 1700,
            autoplayStopOnLast: true,
            paginationClickable: true,
            nextButton: '.swiper-button-next',
            prevButton: '.swiper-button-prev',
            coverflow: {
                rotate: 0,
                stretch: 400,
                depth: 300,
                modifier: 1,
                shadows: true
            }
        });
        m.find(".text").text(data[index].content) //text
        m.addClass("show");
    }, 2000)
}

$(document).on("click", ".daba", function() {
    time = $(this).index() - 1;
    go();
})
$(document).on("click", ".toggle", function() {
    if ($(this).hasClass("icon-play")) {
        $(this).removeClass("icon-play").addClass("icon-pause");
        start();
    } else if ($(this).hasClass("icon-pause")) {
        stop();
        $(this).removeClass("icon-pause").addClass("icon-play");
    }
})
</script>

</html>
